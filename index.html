<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Test Pelatihan Koding & AI untuk Guru</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        .timer-warning { animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red {
            0%, 100% { transform: scale(1); box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 25px rgba(239, 68, 68, 0.7); }
        }
        .gradient-bg { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #bae6fd 100%); }
        .card-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .answer-label:hover { background-color: #f3f4f6; }
        .answer-input:checked + .answer-label { background-color: #1d4ed8; color: white; border-color: #1d4ed8; }
        /* Style untuk select dropdown agar panahnya lebih baik */
        select { background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='currentColor'%3e%3cpath d='M7 7l3-3 3 3m0 6l-3 3-3-3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1.5em 1.5em; }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">

    <!-- Modal Notifikasi (Loading & Pesan) -->
    <div id="notificationModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden flex items-center justify-center z-50 transition-opacity duration-300 opacity-0">
        <div id="modalBox" class="bg-white rounded-xl card-shadow p-8 max-w-sm w-full transition-all duration-300 scale-95 opacity-0 transform">
            <div id="modalContent">
                <!-- Konten Modal: Loading/Pesan Sukses/Pesan Error -->
            </div>
            <div id="modalActions" class="text-right mt-4 hidden">
                <button onclick="hideModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-150">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Kontainer Utama -->
    <div class="w-full max-w-3xl my-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-gray-900">Pre-Test Pelatihan</h1>
            <p class="text-lg text-gray-600">Koding & AI untuk Guru</p>
        </header>

        <!-- Formulir Multi-Step -->
        <form id="preTestForm" class="bg-white rounded-xl card-shadow p-6 sm:p-8">
            <!-- STEP 1: Biodata Peserta -->
            <div id="step1" class="step">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800 border-b pb-2">Data Peserta</h2>

                <!-- Dropdown Kelas -->
                <label class="block mb-4">
                    <span class="text-gray-700 font-medium">Kelas Pelatihan <span class="text-red-500">*</span></span>
                    <select id="selectKelas" name="kelas" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 appearance-none bg-white pr-8" onchange="fetchParticipantsByClass(this.value)" required>
                        <option value="" disabled selected>Memuat Kelas...</option>
                    </select>
                </label>

                <!-- Dropdown Nama -->
                <label class="block mb-4">
                    <span class="text-gray-700 font-medium">Nama Lengkap <span class="text-red-500">*</span></span>
                    <select id="selectNama" name="nama" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 appearance-none bg-white pr-8" onchange="handleManualInput('nama')" disabled required>
                        <option value="" disabled selected>Pilih Kelas terlebih dahulu</option>
                    </select>
                </label>
                <!-- Input Manual Nama (Conditional) -->
                <div id="manualNamaContainer" class="hidden mb-4">
                    <label class="block">
                        <span class="text-red-600 font-medium">Nama Lengkap (Input Manual) <span class="text-red-500">*</span></span>
                        <input type="text" id="inputNamaManual" class="mt-1 block w-full rounded-md border-red-400 shadow-sm focus:border-red-500 focus:ring focus:ring-red-200 focus:ring-opacity-50 p-2 bg-red-50" placeholder="Masukkan nama Anda secara manual" />
                    </label>
                </div>

                <!-- Dropdown Sekolah -->
                <label class="block mb-4">
                    <span class="text-gray-700 font-medium">Asal Sekolah <span class="text-red-500">*</span></span>
                    <select id="selectSekolah" name="sekolah" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 appearance-none bg-white pr-8" onchange="handleManualInput('sekolah')" disabled required>
                        <option value="" disabled selected>Pilih Kelas terlebih dahulu</option>
                    </select>
                </label>
                <!-- Input Manual Sekolah (Conditional) -->
                <div id="manualSekolahContainer" class="hidden mb-4">
                    <label class="block">
                        <span class="text-red-600 font-medium">Asal Sekolah (Input Manual) <span class="text-red-500">*</span></span>
                        <input type="text" id="inputSekolahManual" class="mt-1 block w-full rounded-md border-red-400 shadow-sm focus:border-red-500 focus:ring focus:ring-red-200 focus:ring-opacity-50 p-2 bg-red-50" placeholder="Masukkan nama sekolah secara manual" />
                    </label>
                </div>
                
                <div class="flex justify-end pt-4 border-t mt-6">
                    <button type="button" onclick="nextStep(1)" id="nextStep1Button" class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md disabled:bg-indigo-300" disabled>
                        Lanjutkan ke Soal
                    </button>
                </div>
            </div>

            <!-- STEP 2: Soal Pre-Test (Contoh 20 Soal) -->
            <div id="step2" class="step hidden">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800 border-b pb-2">Soal Pre-Test (20 Pilihan Ganda)</h2>

                <div id="timerDisplay" class="sticky top-0 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl mb-6 text-center font-bold text-lg transition duration-500 ease-in-out">
                    Waktu Tersisa: <span id="timeRemaining">15:00</span>
                </div>

                <div id="questionsContainer" class="space-y-6">
                    <!-- Soal 1 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="1">
                        <p class="font-semibold text-gray-800 mb-3">1. Manakah dari berikut ini yang merupakan definisi paling tepat dari "Pemrograman Komputer"?</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban1" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Proses merancang tampilan visual sebuah aplikasi.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban1" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Proses menulis instruksi langkah demi langkah agar komputer dapat menjalankan tugas tertentu.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban1" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Aktivitas menginstal perangkat lunak baru di komputer.</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Soal 2 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="2">
                        <p class="font-semibold text-gray-800 mb-3">2. Apa fungsi utama dari **variabel** dalam pemrograman?</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban2" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Menyimpan atau merepresentasikan nilai data.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban2" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Menghubungkan program dengan internet.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban2" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Membuat tampilan program menjadi indah.</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Soal 3 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="3">
                        <p class="font-semibold text-gray-800 mb-3">3. Dalam konteks AI, apa yang dimaksud dengan **Machine Learning**?</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban3" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Proses merekam data secara manual ke dalam database.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban3" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Bidang ilmu yang memberikan kemampuan komputer untuk belajar dari data tanpa diprogram secara eksplisit.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban3" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Penggunaan mesin fisik (robot) untuk menyelesaikan tugas.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 4 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="4">
                        <p class="font-semibold text-gray-800 mb-3">4. Algoritma adalah...</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban4" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Serangkaian langkah-langkah yang terstruktur dan terbatas untuk memecahkan masalah.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban4" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Sebuah bahasa pemrograman.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban4" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Nama dari program antivirus.</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Soal 5 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="5">
                        <p class="font-semibold text-gray-800 mb-3">5. Apa itu **Debugging**?</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban5" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Proses menjalankan program untuk pertama kali.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban5" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Proses menemukan dan memperbaiki kesalahan (bug) dalam kode program.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban5" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Memberi nama pada variabel.</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Soal 6 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="6">
                        <p class="font-semibold text-gray-800 mb-3">6. Dalam bahasa pemrograman, **If-Else** digunakan untuk...</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban6" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Mengulangi sebuah blok kode berulang kali.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban6" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Mengambil keputusan berdasarkan suatu kondisi (Control Flow).</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban6" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Menampilkan pesan error.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 7 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="7">
                        <p class="font-semibold text-gray-800 mb-3">7. Apa yang dilakukan oleh **Loop (perulangan)** dalam kode?</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban7" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Menghentikan program secara mendadak.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban7" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Melakukan serangkaian instruksi secara berulang-ulang sampai kondisi tertentu terpenuhi.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban7" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Menyimpan banyak nilai dalam satu variabel.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 8 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="8">
                        <p class="font-semibold text-gray-800 mb-3">8. **Block-based programming** seperti Scratch, cocok untuk pengajar atau siswa karena...</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban8" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Memiliki lebih banyak fitur daripada bahasa pemrograman berbasis teks.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban8" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Memungkinkan siswa fokus pada konsep logika tanpa harus mengingat sintaksis yang rumit.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban8" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Hanya bisa digunakan untuk membuat game.</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Soal 9 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="9">
                        <p class="font-semibold text-gray-800 mb-3">9. Yang BUKAN termasuk kegunaan utama **Kecerdasan Buatan (AI)** di era modern adalah:</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban9" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Penciptaan energi listrik terbarukan (non-core AI application).</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban9" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Pengenalan wajah dan gambar (Image Recognition).</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban9" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Sistem rekomendasi (e-commerce, streaming).</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 10 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="10">
                        <p class="font-semibold text-gray-800 mb-3">10. Dalam konteks pemrograman web, apa yang dilakukan oleh **HTML**?</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban10" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Menentukan struktur dan konten halaman web.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban10" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Memberikan gaya (style) pada halaman web.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban10" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Menambahkan interaktivitas (perilaku) pada halaman web.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 11 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="11">
                        <p class="font-semibold text-gray-800 mb-3">11. **CSS** digunakan untuk:</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban11" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Memberikan gaya, warna, dan tata letak pada elemen HTML.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban11" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Menghitung rumus matematika yang kompleks.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban11" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Menyimpan data secara permanen.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 12 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="12">
                        <p class="font-semibold text-gray-800 mb-3">12. Bahasa pemrograman yang paling umum digunakan untuk menambahkan interaktivitas ke halaman web adalah:</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban12" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Python</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban12" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>JavaScript</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban12" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>C++</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 13 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="13">
                        <p class="font-semibold text-gray-800 mb-3">13. Apa yang dimaksud dengan **Data Set** dalam konteks AI?</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban13" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Sebuah program komputer tunggal.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban13" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Kumpulan data terstruktur yang digunakan untuk melatih model Machine Learning.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban13" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Perangkat keras (hardware) yang digunakan untuk AI.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 14 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="14">
                        <p class="font-semibold text-gray-800 mb-3">14. Salah satu contoh penerapan AI dalam kehidupan sehari-hari adalah...</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban14" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Menghitung menggunakan kalkulator manual.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban14" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Robot penyedot debu otomatis (Robotic Vacuum Cleaner).</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban14" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Membuat salinan dokumen menggunakan mesin fotokopi.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 15 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="15">
                        <p class="font-semibold text-gray-800 mb-3">15. Apa peran **pseudocode** dalam pemrograman?</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban15" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Menulis kode menggunakan bahasa pemrograman tertentu.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban15" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Mendeskripsikan logika algoritma dalam bahasa manusia yang informal, sebelum menulis kode.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban15" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Memberikan komentar pada kode.</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Soal 16 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="16">
                        <p class="font-semibold text-gray-800 mb-3">16. Manakah dari berikut ini yang merupakan contoh dari **Input** pada program komputer?</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban16" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Data yang dimasukkan melalui keyboard atau mouse.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban16" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Gambar yang ditampilkan di layar.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban16" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Suara yang keluar dari speaker.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 17 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="17">
                        <p class="font-semibold text-gray-800 mb-3">17. Istilah **Cloud Computing** merujuk pada:</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban17" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Penggunaan komputer berbasis awan (Cloud-based computing).</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban17" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Layanan komputasi (server, penyimpanan, database, jaringan, perangkat lunak) melalui internet.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban17" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Menggunakan penyimpanan USB (flash drive) untuk berbagi file.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 18 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="18">
                        <p class="font-semibold text-gray-800 mb-3">18. Manakah yang paling menggambarkan **Tujuan Pembelajaran** dalam kurikulum TIK?</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban18" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Apa yang harus dipelajari guru untuk mengajar materi.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban18" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Pernyataan tentang hasil belajar yang diharapkan dapat dicapai oleh siswa setelah menyelesaikan suatu kegiatan pembelajaran.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban18" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Judul dari bab yang akan diajarkan.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 19 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="19">
                        <p class="font-semibold text-gray-800 mb-3">19. Salah satu manfaat utama dari **Computational Thinking** bagi siswa adalah:</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban19" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Meningkatkan kemampuan siswa dalam menghafal fakta-fakta sejarah.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban19" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Mengembangkan keterampilan pemecahan masalah (problem-solving) yang dapat diterapkan di semua mata pelajaran.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban19" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Membuat siswa lebih cepat mengetik di keyboard.</span>
                            </label>
                        </div>
                    </div>

                    <!-- Soal 20 -->
                    <div class="bg-gray-50 p-4 rounded-lg border question" data-question-id="20">
                        <p class="font-semibold text-gray-800 mb-3">20. **Blok kode** dalam Scratch mewakili konsep dasar pemrograman seperti:</p>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban20" value="A" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">A</span>
                                <span>Sintaksis, Tata Bahasa, dan Konjungsi.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban20" value="B" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">B</span>
                                <span>Urutan, Perulangan, dan Kondisi.</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer answer-label transition duration-150">
                                <input type="radio" name="jawaban20" value="C" class="answer-input hidden">
                                <span class="w-6 h-6 rounded-full border flex items-center justify-center mr-3 font-medium flex-shrink-0">C</span>
                                <span>Aljabar, Geometri, dan Statistik.</span>
                            </label>
                        </div>
                    </div>
                </div> <!-- End questionsContainer -->

                <div class="flex justify-between pt-6 border-t mt-8">
                    <button type="button" onclick="prevStep(2)" class="px-6 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-150 shadow-md">
                        &larr; Kembali
                    </button>
                    <div id="finishButtonContainer">
                        <button type="submit" class="px-6 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-md">
                            Selesaikan Tes
                        </button>
                    </div>
                </div>
            </div>

            <!-- STEP 3: Hasil/Result -->
            <div id="step3" class="step hidden text-center">
                <h2 class="text-3xl font-bold text-indigo-700 mb-6">Hasil Pre-Test Anda</h2>
                <div class="space-y-4 max-w-sm mx-auto p-6 rounded-xl bg-indigo-50 border border-indigo-200">
                    <p class="text-xl font-medium text-gray-700">Total Soal: <span id="resultTotal" class="font-bold text-indigo-800">0</span></p>
                    <p class="text-xl font-medium text-gray-700">Jawaban Benar: <span id="resultCorrect" class="font-bold text-green-700">0</span></p>
                    <p class="text-xl font-medium text-gray-700">Jawaban Salah: <span id="resultIncorrect" class="font-bold text-red-700">0</span></p>
                </div>
                <p class="text-gray-600 mt-6">Terima kasih telah menyelesaikan Pre-Test. Hasil Anda telah direkam.</p>
                <button type="button" onclick="window.location.reload();" class="mt-6 px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md">
                    Selesai & Muat Ulang
                </button>
            </div>
        </form>
    </div>


    <script>
        // --- KONFIGURASI JAWABAN BENAR ---
        const CORRECT_ANSWERS = {
            jawaban1: 'B', jawaban2: 'A', jawaban3: 'B', jawaban4: 'A', jawaban5: 'B',
            jawaban6: 'B', jawaban7: 'B', jawaban8: 'B', jawaban9: 'A', jawaban10: 'A',
            jawaban11: 'A', jawaban12: 'B', jawaban13: 'B', jawaban14: 'B', jawaban15: 'B',
            jawaban16: 'A', jawaban17: 'B', jawaban18: 'B', jawaban19: 'B', jawaban20: 'B'
        };

        // --- VARIABEL GLOBAL ---
        let currentStep = 1;
        let timerInterval;
        let timeInSeconds = 15 * 60; // 15 menit
        let isTimerRunning = false;
        let onModalCloseCallback = null; // Callback untuk aksi setelah modal ditutup

        // --- MANAJEMEN STEP FORM ---
        function showStep(step) {
            document.querySelectorAll('.step').forEach(el => el.classList.add('hidden'));
            document.getElementById('step' + step).classList.remove('hidden');
            currentStep = step;

            if (step === 2 && !isTimerRunning) {
                startTimer();
            }
        }

        function nextStep(current) {
            if (current === 1) {
                if (validateForm()) {
                    showStep(2);
                }
            }
        }

        function prevStep(current) {
             if (current === 2) {
                // Konfirmasi kembali ke biodata
                showModal('confirmation', 'Apakah Anda yakin ingin kembali ke halaman biodata? Waktu pengerjaan tidak akan berhenti.', () => {
                     showStep(1);
                });
            }
        }

        // --- VALIDASI & PENGAMBILAN DATA ---
        function validateForm() {
            const selectKelas = document.getElementById('selectKelas');
            const selectNama = document.getElementById('selectNama');
            const selectSekolah = document.getElementById('selectSekolah');
            const inputNamaManual = document.getElementById('inputNamaManual');
            const inputSekolahManual = document.getElementById('inputSekolahManual');
            
            let isValid = true;
            let finalNama = '';
            let finalSekolah = '';

            // 1. Validasi Kelas
            if (!selectKelas.value) {
                selectKelas.classList.add('border-red-500');
                isValid = false;
            } else {
                 selectKelas.classList.remove('border-red-500');
            }

            // 2. Validasi Nama
            if (selectNama.value === 'MANUAL_INPUT') {
                finalNama = inputNamaManual.value.trim();
                if (finalNama === '') {
                    inputNamaManual.classList.add('border-red-500');
                    isValid = false;
                } else {
                    inputNamaManual.classList.remove('border-red-500');
                }
            } else if (!selectNama.value) {
                selectNama.classList.add('border-red-500');
                isValid = false;
            } else {
                finalNama = selectNama.value;
                 selectNama.classList.remove('border-red-500');
            }

            // 3. Validasi Sekolah
            if (selectSekolah.value === 'MANUAL_INPUT') {
                finalSekolah = inputSekolahManual.value.trim();
                if (finalSekolah === '') {
                    inputSekolahManual.classList.add('border-red-500');
                    isValid = false;
                } else {
                    inputSekolahManual.classList.remove('border-red-500');
                }
            } else if (!selectSekolah.value) {
                selectSekolah.classList.add('border-red-500');
                isValid = false;
            } else {
                finalSekolah = selectSekolah.value;
                selectSekolah.classList.remove('border-red-500');
            }

            if (!isValid) {
                showModal('error', 'Mohon lengkapi semua data peserta yang wajib diisi.');
            }

            return isValid;
        }

        function getFormData() {
            const data = {};
            const form = document.getElementById('preTestForm');

            // Ambil data Biodata (Nama, Sekolah, Kelas)
            const selectKelas = document.getElementById('selectKelas');
            const selectNama = document.getElementById('selectNama');
            const selectSekolah = document.getElementById('selectSekolah');
            const inputNamaManual = document.getElementById('inputNamaManual');
            const inputSekolahManual = document.getElementById('inputSekolahManual');

            data.kelas = selectKelas.value;
            data.nama = selectNama.value === 'MANUAL_INPUT' ? inputNamaManual.value.trim() : selectNama.value;
            data.sekolah = selectSekolah.value === 'MANUAL_INPUT' ? inputSekolahManual.value.trim() : selectSekolah.value;

            // Ambil Jawaban
            const questions = document.querySelectorAll('.question');
            let correctCount = 0;
            let incorrectCount = 0;
            const totalQuestions = questions.length;

            questions.forEach(q => {
                const qId = q.getAttribute('data-question-id');
                const name = 'jawaban' + qId;
                const selected = form.querySelector(`input[name="${name}"]:checked`);
                const answer = selected ? selected.value : '';
                data[name] = answer;

                if (answer) {
                    if (answer === CORRECT_ANSWERS[name]) {
                        correctCount++;
                    } else {
                        incorrectCount++;
                    }
                } else {
                    // Jawaban kosong dihitung salah jika ingin mencatat semua soal
                    incorrectCount++; 
                }
            });

            data.benar = correctCount;
            data.salah = incorrectCount;

            return { formData: data, resultData: { correct: correctCount, incorrect: incorrectCount, total: totalQuestions } };
        }

        // --- LOGIKA TIMER ---
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            const display = document.getElementById('timeRemaining');
            const timerContainer = document.getElementById('timerDisplay');
            display.textContent = formatTime(timeInSeconds);

            if (timeInSeconds <= 60) {
                timerContainer.classList.add('timer-warning');
            } else {
                timerContainer.classList.remove('timer-warning');
            }
        }

        function startTimer() {
            if (isTimerRunning) return;
            isTimerRunning = true;
            updateTimerDisplay();

            timerInterval = setInterval(() => {
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    isTimerRunning = false;
                    showModal('error', 'Waktu pengerjaan telah habis! Jawaban Anda akan dikirim secara otomatis.', submitForm);
                } else {
                    timeInSeconds--;
                    updateTimerDisplay();
                }
            }, 1000);
        }

        // --- SUBMIT FORM ---
        function submitForm(event) {
            if (event) event.preventDefault();
            
            // Validasi cepat (bukan validasi detail)
            if (currentStep !== 2) return;
            
            const { formData, resultData } = getFormData();
            
            showLoading('Mengirim jawaban Anda...');
            const finishButton = document.querySelector('#finishButtonContainer button');
            finishButton.disabled = true;

            // Hentikan timer
            if (timerInterval) {
                clearInterval(timerInterval);
                isTimerRunning = false;
            }

            submitToGoogleScripts(formData, resultData);
        }

        function showResult(correct, incorrect, total) {
            document.getElementById('resultCorrect').textContent = correct;
            document.getElementById('resultIncorrect').textContent = incorrect;
            document.getElementById('resultTotal').textContent = total;
            showStep(3);
        }

        // --- LOGIKA MODAL ---
        function showLoading(message = 'Memproses...') {
            const modalContent = document.getElementById('modalContent');
            const modalActions = document.getElementById('modalActions');
            modalContent.innerHTML = `
                <div class="flex flex-col items-center">
                    <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-indigo-500 mb-4"></div>
                    <p class="text-lg font-semibold text-gray-800">${message}</p>
                </div>
            `;
            modalActions.classList.add('hidden');
            document.getElementById('notificationModal').classList.remove('hidden', 'opacity-0');
            document.getElementById('notificationModal').classList.add('opacity-100');
            document.getElementById('modalBox').classList.remove('scale-95', 'opacity-0');
            document.getElementById('modalBox').classList.add('scale-100', 'opacity-100');
        }

        function showModal(type, message, onConfirmCallback = null) {
            hideLoading(); // Pastikan loading tersembunyi
            const modal = document.getElementById("notificationModal");
            const modalBox = document.getElementById("modalBox");
            const modalContent = document.getElementById("modalContent");
            const modalActions = document.getElementById("modalActions");

            let iconHtml = '';
            let title = '';
            let buttonHtml = '';

            if (type === 'success') {
                title = 'Berhasil!';
                iconHtml = '<svg class="w-8 h-8 text-green-500 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                buttonHtml = '<button onclick="hideModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-150">Tutup</button>';
            } else if (type === 'error') {
                title = 'Terjadi Kesalahan';
                iconHtml = '<svg class="w-8 h-8 text-red-500 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                 if (onConfirmCallback) {
                     buttonHtml = `<button onclick="hideModal(() => { ${onConfirmCallback.name ? onConfirmCallback.name + '()' : 'onModalCloseCallback();'} })" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-150">Oke</button>`;
                } else {
                     buttonHtml = '<button onclick="hideModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-150">Tutup</button>';
                }
            } else if (type === 'confirmation') {
                title = 'Konfirmasi';
                iconHtml = '<svg class="w-8 h-8 text-yellow-500 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>';
                buttonHtml = `
                    <button onclick="hideModal()" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-100 transition duration-150 mr-2">Batal</button>
                    <button onclick="hideModal(${onConfirmCallback.name});" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-150">Ya, Lanjutkan</button>
                `;
            }
            
            if(onConfirmCallback && type !== 'confirmation') {
                onModalCloseCallback = onConfirmCallback;
            }


            modalContent.innerHTML = `
                <div class="text-center">
                    ${iconHtml}
                    <h3 class="text-xl font-bold text-gray-900 mb-2">${title}</h3>
                    <p class="text-gray-700">${message}</p>
                </div>
            `;
            
            modalActions.innerHTML = buttonHtml;
            modalActions.classList.remove('hidden');


            modal.classList.remove("hidden", "opacity-0");
            modal.classList.add("opacity-100");
            modalBox.classList.remove("scale-95", "opacity-0");
            modalBox.classList.add("scale-100", "opacity-100");
        }

        function hideLoading() {
            const modal = document.getElementById("notificationModal");
            const modalBox = document.getElementById("modalBox");
            if (modal.classList.contains('hidden')) return; // Hanya sembunyikan jika loading yang tampil

            modalBox.classList.add("scale-95", "opacity-0");
            modal.classList.remove("opacity-100");
            setTimeout(() => {
                modal.classList.add("hidden");
            }, 300);
        }
        
        function hideModal(callback) {
            const modal = document.getElementById("notificationModal");
            const modalBox = document.getElementById("modalBox");
            
            modalBox.classList.add("scale-95", "opacity-0");
            modal.classList.remove("opacity-100");
            
            setTimeout(() => {
                modal.classList.add("hidden");
                if (typeof callback === "function") {
                    callback();
                } else if (onModalCloseCallback) {
                    onModalCloseCallback();
                    onModalCloseCallback = null;
                }
            }, 300);
        }

        // --- FUNGSI KOMUNIKASI GOOGLE SCRIPT ---
        function submitToGoogleScripts(data, resultData) {
            const finishButton = document.querySelector('#finishButtonContainer button');
            
            google.script.run
                .withSuccessHandler(response => {
                    hideLoading();
                    if (response.result === 'success') {
                         showResult(resultData.correct, resultData.incorrect, resultData.total);
                         showModal('success', 'Jawaban Anda telah berhasil direkam. Terima kasih!');
                    } else {
                        showModal('error', 'Gagal menyimpan data: ' + response.error);
                        finishButton.disabled = false;
                    }
                })
                .withFailureHandler(error => {
                     hideLoading();
                     showModal('error', 'Gagal terhubung ke server. Silakan periksa koneksi internet Anda atau hubungi fasilitator. (' + error.message + ')');
                     finishButton.disabled = false;
                })
                .submitTestAnswers(data);
        }

        // --- FUNGSI DROPDOWN DINAMIS (BARU) ---
        
        // Memuat semua kelas saat halaman dimuat
        function loadAllClasses() {
            showLoading('Memuat daftar kelas...');
            const selectKelas = document.getElementById('selectKelas');
            selectKelas.innerHTML = '<option value="" disabled selected>Memuat Kelas...</option>';
            selectKelas.disabled = true;

            google.script.run
                .withSuccessHandler(classes => {
                    hideLoading();
                    selectKelas.disabled = false;
                    selectKelas.innerHTML = '<option value="" disabled selected>Pilih Kelas Anda</option>';
                    if (classes.length === 0) {
                         selectKelas.innerHTML += '<option value="" disabled>Tidak ada data kelas ditemukan</option>';
                         document.getElementById('nextStep1Button').disabled = true;
                         showModal('error', 'Data kelas pelatihan tidak ditemukan di spreadsheet. Mohon hubungi fasilitator.');
                         return;
                    }
                    classes.forEach(cls => {
                        selectKelas.innerHTML += `<option value="${cls}">${cls}</option>`;
                    });
                     // Setelah berhasil, aktifkan tombol Lanjutkan jika kelas sudah dipilih
                    document.getElementById('nextStep1Button').disabled = selectKelas.value === "";
                })
                .withFailureHandler(error => {
                    hideLoading();
                    selectKelas.innerHTML = '<option value="" disabled selected>Gagal Memuat Kelas</option>';
                    showModal('error', 'Gagal memuat data kelas: ' + error.message);
                })
                .getAllClasses();
        }

        // Memuat nama dan sekolah berdasarkan kelas yang dipilih
        function fetchParticipantsByClass(kelas) {
            if (!kelas) return;
            showLoading('Memuat daftar peserta...');
            
            const selectNama = document.getElementById('selectNama');
            const selectSekolah = document.getElementById('selectSekolah');
            const nextButton = document.getElementById('nextStep1Button');

            selectNama.disabled = true;
            selectSekolah.disabled = true;
            nextButton.disabled = true;

            selectNama.innerHTML = '<option value="" disabled selected>Memuat...</option>';
            selectSekolah.innerHTML = '<option value="" disabled selected>Memuat...</option>';
            
            // Sembunyikan input manual dan reset
            handleManualInput('nama', true);
            handleManualInput('sekolah', true);


            google.script.run
                .withSuccessHandler(data => {
                    hideLoading();
                    selectNama.disabled = false;
                    selectSekolah.disabled = false;
                    nextButton.disabled = false;

                    // 1. Populasi Nama
                    populateDropdown(selectNama, data.nama, 'Pilih Nama Anda', 'Nama tidak ada (Input Manual)');
                    
                    // 2. Populasi Sekolah
                    populateDropdown(selectSekolah, data.sekolah, 'Pilih Asal Sekolah Anda', 'Sekolah tidak ada (Input Manual)');

                })
                .withFailureHandler(error => {
                    hideLoading();
                    selectNama.innerHTML = '<option value="" disabled selected>Gagal Memuat Nama</option>';
                    selectSekolah.innerHTML = '<option value="" disabled selected>Gagal Memuat Sekolah</option>';
                    nextButton.disabled = true;
                    showModal('error', 'Gagal memuat daftar peserta: ' + error.message);
                })
                .getPesertaByKelas(kelas);
        }

        // Fungsi bantu untuk mengisi dropdown
        function populateDropdown(selectElement, items, defaultText, manualText) {
            selectElement.innerHTML = '';
            selectElement.innerHTML += `<option value="" disabled selected>${defaultText}</option>`;
            
            // Tambahkan opsi "Input Manual"
            selectElement.innerHTML += `<option value="MANUAL_INPUT" class="text-red-600 font-bold">${manualText}</option>`;

            // Tambahkan data dari spreadsheet
            items.forEach(item => {
                // Gunakan item sebagai value dan text
                selectElement.innerHTML += `<option value="${item}">${item}</option>`;
            });
        }

        // Fungsi untuk menampilkan/menyembunyikan input manual
        function handleManualInput(fieldType, reset = false) {
            const selectElement = document.getElementById(`select${fieldType.charAt(0).toUpperCase() + fieldType.slice(1)}`);
            const manualContainer = document.getElementById(`manual${fieldType.charAt(0).toUpperCase() + fieldType.slice(1)}Container`);
            const manualInput = document.getElementById(`input${fieldType.charAt(0).toUpperCase() + fieldType.slice(1)}Manual`);

            if (reset || selectElement.value === 'MANUAL_INPUT') {
                manualContainer.classList.remove('hidden');
                manualInput.required = true;
            } else {
                manualContainer.classList.add('hidden');
                manualInput.required = false;
                manualInput.value = ''; // Kosongkan nilai input manual
                manualInput.classList.remove('border-red-500'); // Hapus validasi visual
            }
        }


        // --- EVENT LISTENER & INIT ---
        document.getElementById('preTestForm').addEventListener('submit', submitForm);

        window.onload = function () {
            // Inisialisasi: Muat semua kelas
            loadAllClasses();
            showStep(1); // Mulai di biodata
        };
    </script>
</body>
</html>
